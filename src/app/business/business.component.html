<div class="filter-table-container">
  <div class="filter-row">
    <div class="search-filter">
      <i class="fa-solid fa-magnifying-glass"></i>
      <input type="text" placeholder="Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·.." [(ngModel)]="searchQuery" (change)="onSearch()">
    </div>

    <div class="search-filter date-from">
      <input type="text" [ngModel]="dateFrom" [value]="dateFrom" placeholder="Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î‘Ï€ÏŒ" readonly
             (click)="openDatePicker(datePickerFrom)">
      <input type="date" #datePickerFrom (change)="setDateFrom($event)" class="hidden-datepicker">
    </div>
    <div class="search-filter date-to">
      <input type="text" [ngModel]="dateTo" placeholder="Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± ÎœÎ­Ï‡ÏÎ¹" readonly
             (click)="openDatePicker(datePickerTo)">
      <input type="date" #datePickerTo (change)="setDateTo($event)" class="hidden-datepicker">
    </div>
    <div class="open-filter" (click)="toggleFilters()">
      <i class="fa-solid" [ngClass]="showFilters ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
    </div>

  </div>


  <div class="toggle-filter" *ngIf="showFilters">
    <div class="toggle-row">
      <label class="field-label">Î•Î¾Î¿Ï†Î»Î®Î¸Î·ÎºÎµ</label>
      <div class="toggle-buttons">
        <label><input type="radio" name="paid" [(ngModel)]="filterPayout" [value]="true" (change)="onSearch()"/>
          ÎÎ±Î¹</label>
        <label><input type="radio" name="paid" [(ngModel)]="filterPayout" [value]="false" (change)="onSearch()"/>
          ÎŒÏ‡Î¹</label>
        <span class="reset-icon" (click)="resetToggle('filterPayout')">Ã—</span>
      </div>
    </div>
    <div class="toggle-row">
      <label class="field-label">Î‘ÏÏ‡ÎµÎ¯Î±</label>
      <div class="toggle-buttons">
        <label><input type="radio" name="files" [(ngModel)]="filterFilesCompleted" [value]="true"
                      (change)="onSearch()"/> ÎÎ±Î¹</label>
        <label><input type="radio" name="files" [(ngModel)]="filterFilesCompleted" [value]="false"
                      (change)="onSearch()"/> ÎŒÏ‡Î¹</label>
        <span class="reset-icon" (click)="resetToggle('filterFilesCompleted')">Ã—</span>

      </div>
    </div>
    <div class="toggle-row">
      <label class="field-label">Î Î±ÏÎ¬Î´Î¿ÏƒÎ·</label>
      <div class="toggle-buttons">
        <label><input type="radio" name="delivery" [(ngModel)]="filterFilesDelivered" [value]="true"
                      (change)="onSearch()"/> ÎÎ±Î¹</label>
        <label><input type="radio" name="delivery" [(ngModel)]="filterFilesDelivered" [value]="false"
                      (change)="onSearch()"/> ÎŒÏ‡Î¹</label>
        <span class="reset-icon" (click)="resetToggle('filterFilesDelivered')">Ã—</span>
      </div>
    </div>
  </div>


  <div class="container">
    <div class="table-container">
      <table class="table">
        <thead>
        <!-- ğŸ”µ Button Row (directly in table structure) -->
        <tr class="button-row">
          <td colspan="15">
            <div class="button-bar">
              <button class="btn-create" (click)="addBusiness()">â• Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±</button>
              <button class="btn-export" (click)="exportToExcel()">
                <i style="color: green" class="fa-solid fa-file-excel"></i></button>
<!--              <button class="export-button" (click)="exportToExcel()">-->

<!--              </button>-->
            </div>
          </td>
        </tr>
        <tr>
          <th>#</th>
          <th>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</th>
          <th>Î¤ÏÏ€Î¿Ï‚</th>
          <th>Î Î¿Î¹Î¿Ï‚</th>
          <th>Î ÎµÏÎ¹Î¿Ï‡Î®</th>
          <th>Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚</th>
          <th>ÎˆÎ¾Î¿Î´Î±</th>
          <th>Î‘Î¼Î¿Î¹Î²Î®</th>
          <th>Î ÏÎ¿ÎºÎ±Ï„Î±Î²Î¿Î»Î®</th>
          <th>Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿</th>
          <th>Î•Î¾Î¿Ï†Î»Î®Î¸Î·ÎºÎµ</th>
          <th>Î‘ÏÏ‡ÎµÎ¯Î±</th>
          <th>Î Î±ÏÎ¬Î´Î¿ÏƒÎ·</th>
          <th>Î£Ï‡ÏŒÎ»Î¹Î±</th>
          <th></th>
        </tr>

        </thead>
        <tbody>
        <tr *ngFor="let business of businessList; let i = index">
          <td>{{ (page * size) + i + 1 }}</td>

          <td>{{ business.date }}</td>
          <td>{{ business.type }}</td>
          <td>{{ business.who }}</td>
          <td>{{ business.area }}</td>
          <td>{{ business.details }}</td>
          <td>{{ business.costs }}</td>
          <td>{{ business.fee }}</td>
          <td>{{ business.advancePayment }}</td>
          <td>{{ business.remainingMoney }}</td>
          <td>{{ convertBoolean(business.payout) }}</td>
          <td>{{ convertBoolean(business.filesCompleted) }}</td>
          <td>{{ convertBoolean(business.filesDelivered) }}</td>
          <td>{{ business.comments }}</td>
          <td>
            <div class="dropdown" (click)="toggleDropdown($event, business.id)">
              <button class="menu-btn">â‹®</button>
              <ul class="dropdown-menu" *ngIf="openRowId === business.id">
                <li>
                  <button class="edit-btn" (click)="editRow(business)"> Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±</button>
                </li>
                <li>
                  <button class="delete-btn" (click)="deleteRow(business)">Î”Î¹Î±Î³ÏÎ±Ï†Î®</button>
                </li>
              </ul>
            </div>
          </td>


        </tr>
        </tbody>
      </table>
      <div class="table-footer">
        <div class="pagination">
          <button class="pagination-buttons" (click)="onPageChange(page - 1)" [disabled]="page === 0">
            <i class="fa-solid fa-arrow-left"></i>
          </button>
          <span> {{ page + 1 }} of {{ Math.ceil(totalElements / size) }}</span>
          <button class="pagination-buttons" (click)="onPageChange(page + 1)"
                  [disabled]="(page + 1) * size >= totalElements">
            <i class="fa-solid fa-arrow-right"></i>
          </button>
        </div>

      </div>

      <div *ngIf="showForm" class="modal-overlay">
        <div class="modal">
          <i class="fa-solid fa-xmark close-button" (click)="onCancel()"></i>
          <form class="modal-container" [formGroup]="businessForm" (ngSubmit)="submitBusiness()">
            <div class="form-row">
              <div class="input-fields">
                <span class="details">Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</span>
                <input type="date" formControlName="date">
              </div>
              <div class="input-fields">
                <span class="details">Î¤ÏÏ€Î¿Ï‚</span>
                <input type="text" formControlName="type">

              </div>
              <div class="input-fields">
                <span class="details">Î Î¿Î¹Î¿Ï‚</span>
                <input type="text" formControlName="who">
              </div>


              <div class="input-fields">
                <span class="details">Î ÎµÏÎ¹Î¿Ï‡Î®</span>
                <input type="text" formControlName="area">
              </div>
              <div class="input-fields">
                <span class="details">Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚</span>
                <input type="text" formControlName="details">
              </div>

              <div class="form-row">
                <div class="input-fields">
                  <span class="details">Î‘Î¼Î¿Î¹Î²Î®</span>
                  <input type="number" formControlName="fee">
                </div>

                <div class="input-fields">
                  <span class="details">Î ÏÎ¿ÎºÎ±Ï„Î±Î²Î¿Î»Î®</span>
                  <input type="number" formControlName="advancePayment">
                </div>

              </div>
              <div class="form-row">
                <div class="input-fields">
                  <span class="details">Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿</span>
                  <input type="number" formControlName="remainingMoney">
                </div>
                <div class="input-fields">
                  <span class="details">ÎˆÎ¾Î¿Î´Î±</span>
                  <input type="number" formControlName="costs">
                </div>

              </div>

              <div class="input-fields">
                <span class="details">Î£Ï‡ÏŒÎ»Î¹Î±</span>
                <textarea rows="3" formControlName="comments"></textarea>
              </div>
            </div>

            <div style="margin: 10px; align-content: center " class="form-row">
              <span class="details-checkbox">Î‘Ï€Î¿Ï€Î»Î·ÏÏ‰Î¼Î®</span>
              <input type="checkbox" formControlName="payout">


              <span class="details-checkbox">Î‘ÏÏ‡ÎµÎ¯Î±</span>
              <input type="checkbox" formControlName="filesCompleted">


              <span class="details-checkbox">Î Î±ÏÎ¬Î´Î¿ÏƒÎ·</span>
              <input type="checkbox" formControlName="filesDelivered">

            </div>
            <div class="form-actions">
              <button class="cancel-button" type="button" (click)="onCancel()">
                <i class="fas fa-times"></i> Cancel
              </button>
              <button class="save-button" type="submit">
                <i class="fas fa-save"></i> Save
              </button>
            </div>
          </form>
        </div>
      </div>

    </div>

  </div>
</div>
